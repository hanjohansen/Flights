@using Flights.Client.Authentication
@using Flights.Client.Rtc

@inject NavigationManager NavigationManager
@inject IAuthenticationService AuthenticationService;

@implements IAsyncDisposable

@code{
    private readonly RtcHubClient _rtcHubClient = new ();

    protected RtcHubClient EventClient => _rtcHubClient;
    
    protected override async Task OnInitializedAsync()
    {
        var baseUrl = NavigationManager.BaseUri;
        var tenantId = AuthenticationService.Tenant?.Id;
        
        if(tenantId != null)
            await _rtcHubClient.Connect(baseUrl, tenantId.Value);
    }
    
    protected async Task Broadcast(UiEventType messageType, Guid? id)
    {
        if (id != null)
            await _rtcHubClient.PublishGameEvent(messageType, id.Value);
    }
    
    public async ValueTask DisposeAsync()
    {
        await _rtcHubClient.DisposeAsync();
    }
}